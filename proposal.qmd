---
title: "A Student's Review of Expert Reviews of Chocolate Bars"
subtitle: "Proposal"
format: html
editor: visual
---

```{r}
#| label: load-pkgs-data
#| warning: false
#| message: false


library(tidyverse)
library(janitor)

chocolate <- read_csv("data/flavors_of_cacao[1].csv")

chocolate <- chocolate |>
  clean_names()

```

## Dataset

The `chocolate` data set contains information about chocolate bars and reviews written by experts. It contains `r ncol(chocolate)` variables with `r nrow(chocolate)` observations. The data contain information about the company who makes the chocolate bars, the percent of cocoa, where the company is located, bean type & origin, and review (out of 5 stars). It comes from the kaggle data set, Chocolate Bar Ratings: Extensive EDA, by Will Canniford. The original data can be found [here](https://www.kaggle.com/code/willcanniford/chocolate-bar-ratings-extensive-eda/data). Here is a small glimpse into what our data looks like. More detail can be found in our data dictionary located in `data/README.md`

```{r}
#| label: glimpsing-data
#| warning: false
 
glimpse(chocolate)
```

## Why we chose this dataset

We chose this dataset because we believe it had a variety of interesting variables to look at in relationship to the rating the chocolate bar was given. We were especially intrigued by the dataset containing both time and geospatial data. We believe that this will allow us to make informative and visually pleasing graphics. We also all love chocolate.

## Questions

These are the two questions we want to answer.

1. What characteristics of the chocolate make up the most successful chocolate bar in reviews?

2. How do expert reviews change over time for each company?
there reviews are very different

Potential Question: Are the differences we found in chocolate companies explain differences in reviews?

## Analysis plan

1. 

In visualizing the first plot of question (1), we plan to create line plots by year that show the relationship between the cocoa percentage of the chocolate bar and their ratings. This visualization will help us understand how the preference in cocoa percentage level has changed over the years from 2006 to 2017. In creating the variable with year information that will be used in faceting the plots, we will be grouping the year information provided in `review_date` in two's and will create a new character variable using mutate function with conditional arguments that represents the assigned years (e.g. "2006 ~ 2007, "2008 ~ 2009", etc). The variable will then be factored to be in chronological order. For the plot, our x-axis variable is the year and the y-axis variable is the cocoa percentage. The plot will be faceted into 6 time periods assigned within 2006 ~ 2017. Since we would only have a single line in each of the faceted grids, we will modify the color as well as the thickness (size) of the line for better readability.

```{r, message=FALSE}
con2cont <- read_csv("data/countryContinent.csv") %>%
  select(country, continent)

chocolate <- chocolate %>%
  mutate(
    company_location_country = case_when(
      company_location == "U.S.A." ~ "United States of America",
      company_location == "U.K." ~ "United Kingdom of Great Britain and Northern Ireland",
      company_location == "Wales" ~ "United Kingdom of Great Britain and Northern Ireland",
      company_location == "Scotland" ~ "United Kingdom of Great Britain and Northern Ireland",
      company_location == "Russia" ~ "Russian Federation",
      company_location == "South Korea" ~ "Korea (Republic of)",
      company_location == "Amsterdam" ~ "Netherlands",
      company_location == "Sao Tome" ~ "Sao Tome and Principe",
      company_location == "Bolivia" ~ "Bolivia (Plurinational State of)",
      company_location == "Venezuela" ~ "Venezuela (Bolivarian Republic of)",
      company_location == "St. Lucia" ~ "Saint Lucia",
      company_location == "Vietnam" ~ "Viet Nam",
      company_location == "Domincan Republic" ~ "Dominican Republic",
      company_location == "Niacragua" ~ "Nicaragua",
      company_location == "Eucador" ~ "Ecuador",
      TRUE ~ company_location
    )
  ) %>%
  merge(
    x = .,
    y = con2cont,
    by.x = c("company_location_country"),
    by.y = c("country"),
    all.x = TRUE
  )

setdiff(chocolate$company_location_country, con2cont$country)
```

Our second plot will be similar to the first plot in that it will also be exploring how the preference for a certain coffee bean characteristic has changed over time. The plot will be looking at the relationship between the company location/origin and their review ratings for each of the year groups created in completing the first plot. Through this plot, we will be able to better understand which continental group of companies are preferred over time. In order to do this, we plan to implement stacked bar plots for each respective faceted year using geom_bar() function from ggplot2. To group the company locations according to their continents, I used an external dataset named "countryContinent.csv" to map the location data to their continents. I proceeded with data cleaning above using mutate() function to fix typos as well as different nomenclature for country names and left-joined the external dataset by the country names to map the continent information. Then similar to the faceting year variable, we will group the review ratings in 0.5 intervals ("0.0 ~ 0.5", "0.5 ~ 1.0") where the lower bound is exclusive with the exception of the first group. For our plot, we will count the number of ratings for each continent where the companies are located in and accumulate the count of continents for each level of rating using the stacked bar plots. Hence, the x-axis variable will be each review rating level and the y-axis variable will be the count of continents. We will differentiate the continents by using individual colors for easier readability.

2. With regards to the second question, we will make use of the `review_date` on the x axis, `rating` on the y-axis, and company variables (`company_location` and `company_maker_if_known`) to observe how the expert reviews for different companies vary over time. Then using aesthetic parameters of fill and color with our company variables (listed above), we plan to gain a better understanding of what potential changes in characteristics have caused an upward or downward in the review ratings over time. 
If time allows we hope to use our time series plot to potentially map and compare significant changes in chocolate bar `ratings` to significant world events in the industry at the time of the expert review. 


At this time we do not believe we will need to add any external data to answer either question.
