{
  "hash": "f97e94a8bc6d0579a7788edd35e2d516",
  "result": {
    "markdown": "---\ntitle: \"Project title\"\nsubtitle: \"STA/ISS 313 - Project 1\"\nauthor: \"The O_GGS\"\nformat: html\neditor: visual\nexecute:\n  echo: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(maps)\nlibrary(viridis)\nlibrary(ggrepel)\n\nchocolate <- read_csv(\"data/flavors_of_cacao.csv\")\n\ncon2cont <- read_csv(\"data/countryContinent.csv\")\n\nworld <- map_data(\"world\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate <- chocolate |>\n  clean_names() |>\n  mutate(\n    company_location_country = case_when(\n      company_location == \"U.S.A.\" ~ \"United States of America\",\n      company_location == \"U.K.\" ~ \"United Kingdom of Great Britain and Northern Ireland\",\n      company_location == \"Wales\" ~ \"United Kingdom of Great Britain and Northern Ireland\",\n      company_location == \"Scotland\" ~ \"United Kingdom of Great Britain and Northern Ireland\",\n      company_location == \"Russia\" ~ \"Russian Federation\",\n      company_location == \"South Korea\" ~ \"Korea (Republic of)\",\n      company_location == \"Amsterdam\" ~ \"Netherlands\",\n      company_location == \"Sao Tome\" ~ \"Sao Tome and Principe\",\n      company_location == \"Bolivia\" ~ \"Bolivia (Plurinational State of)\",\n      company_location == \"Venezuela\" ~ \"Venezuela (Bolivarian Republic of)\",\n      company_location == \"St. Lucia\" ~ \"Saint Lucia\",\n      company_location == \"Vietnam\" ~ \"Viet Nam\",\n      company_location == \"Domincan Republic\" ~ \"Dominican Republic\",\n      company_location == \"Niacragua\" ~ \"Nicaragua\",\n      company_location == \"Eucador\" ~ \"Ecuador\",\n      TRUE ~ company_location\n    ),\n    cocoa_percent = as.numeric(sub(\"%\", \"\", cocoa_percent))\n    )\n\ncon2cont <- con2cont |>\n  select(country, continent)\n\ncon2cont <- con2cont |>\n  rename(company_location_country = country)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate_merged <- chocolate |>\n  left_join(con2cont,\n            multiple = \"all\")\n```\n:::\n\n\n## Abstract\n\nIn this project, we aim to explore what characteristics (as identified by experts) of chocolate bars lead to the most successful chocolate bars and how expert opinions of these characteristics have changed over time. INSERT RESULTS HERE\n\n------------------------------------------------------------------------\n\n## Introduction\n\n(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.\n\nOur main dataset is the `chocolate` dataset. It contains information about chocolate bars and reviews written by experts. It contains 10 variables with 1795 observations. This dataset contains information about the company who makes the chocolate bars, the percent of cocoa, where the company is located, bean type & origin, expert review (out of 5 stars), and the date and reference number for each review. The original data source can be found [here](https://www.kaggle.com/code/willcanniford/chocolate-bar-ratings-extensive-eda/data) and more in depth information can be found in our data dictionary located in `data/README.md` in this repository.\n\nOur other datasets include `world` and `con2cont` and they are primarily used in our plots that include geospatial variables. `con2cont` maps countries to continents while the `world` dataset gives us coordinates to graph so that we can make map-like visualizations.\n\n## Question 1: What characteristics lead to the most successful chocolate bars?\n\n### Introduction\n\n(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.*DELETE THIS LATER*\n\nWe aim to explore what characteristics of chocolate bars are the most successful as rated out of 5 stars by experts. This information is important for consumers so when they are in the candy aisle at grocery stores faced with dozens of options, they can use these findings to make a well-informed decision about which chocolate they should buy. This is also important for chocolate makers to understand so that they can use this information to improve their own chocolate given the location preferences.\n\nTo answer what characteristics lead to the most successful chocolate bars we will use the variables that describe cocoa percentage in the chocolate, the various companies who are included in this dataset, the origin of the cocoa beans that are used to produce that chocolate bar, and the expert reviews of the chocolate bars.\n\n### Approach\n\n(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g.Â boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.*DELETE THIS LATER*\n\n#### Plot 1.1\n\nFor this first plot, we wanted to vizualize how the cocoa percent in a chocolate bar affects the expert review based on where the chocolate company is located. We believe that there might be general trends for each country that lead to chocolate being more highly rated if the population preferred a specific cocoa percentage. For example, we know Americans have a strong preference for sweeter, less cocoa- filled chocolate and wanted to know if a decrease in cocoa percentage would lead to an increase in reviews.\n\nTo visualize this, we first created a scatterplot to get a general idea of the relationship between a country, their preference for cocoa, and how that might affect the rating. The points were somewhat all stacked on top of each other since a lot of observations had very similar positions. This made it hard to see overall relationships so we made the points a bit transparent to better communicate more frequent cocoa percentage and rating pairings through more concentrated colors. Then we layered trend lines over our scatterplot for 8 countries that are best known for the chocolate they produce (according to outside research). We also chose these countries because they had over 30 companies who manufactured and sold their chocolate there so we thought we would get a pretty representative sample of companies for each country.\n\n#### Plot 1.2\n\nFor this second plot, we thought it would be interesting to observe the relationship between the origin of cocao beans and the expert reviews. Furthermore, given how neighboring countries often have similar climates we believe that preferences for beans from nearby countries should be similar. In order to investigate these relationships we decided to create a map.\n\nThe map was created using the maps package, as inspired by https://eriqande.github.io/rep-res-web/lectures/making-maps-with-R.html. We left_joined the world data set with the average rating for each country from the chocolate data set. This new dataset contained the latitude and longitude coordinates from the world data set which allow us to use the geom_polygon function to create the baseline for the map. The countries were then colored based on rating to show the preferences for their bean origin. Finally, we decided to add labels for certain countries. We tried many variations of labels so that the plot was not cluttered but still provided additional information. These labels chose highlight which countries were the most popular, further showing which areas contained the most popular bean origins.\n\n### Analysis\n\n(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions. *DELETE THIS LATER*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate_merged |>\n  filter(\n    company_location %in% c(\n      \"U.S.A.\", \"France\", \"U.K.\", \"Italy\", \"Ecuador\",\n      \"Belgium\", \"Switzerland\", \"Germany\"\n  )) |>\n  mutate(cocoa_percentage = cocoa_percent / 100) |>\n  ggplot(aes(x = cocoa_percentage, y = rating,\n             color = company_location)) +\n  geom_point(alpha = 0.25) +\n  geom_smooth(se = FALSE) +\n  scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +\n  theme_minimal() +\n  labs(\n    x = \"Percentage of Cocoa\",\n    y = \"Rating (From 1-5)\",\n    title = \"Countries who specialize in a limited cocoa percentages have more consistently higher ratings\",\n    subtitle = \"Top 8 Countries Best Known For Chocolate\",\n    color = \"Chocolate Company Locations\"\n  )\n```\n\n::: {.cell-output-display}\n![Belgium and Switzerland specialize in a limited cocoa percentages which lead to more consistent](index_files/figure-html/fig-dani-1.png){#fig-dani width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_df <- left_join(\n  world,\n  chocolate |>\n    group_by(broad_bean_origin) |>\n    summarise(rating = mean(rating)),\n  by = c(\"region\" = \"broad_bean_origin\")\n)\n\nlabel_df <- world_df |>\n  filter(!is.na(rating)) |>\n  group_by(region) |>\n  summarise(\n    rating = mean(rating),\n    long = mean(long),\n    lat = mean(lat),\n    .groups = \"drop\"\n  )|>\n  arrange(desc(rating))|>\n  head(10)\n\nworld_df |>\n  filter(region != \"Antarctica\") |>\n  ggplot() +\n  aes(x = long,\n      y = lat,\n      group = group,\n      fill = rating) +\n  geom_polygon(color = \"black\", linewidth = 0.2) +\n  geom_label_repel(\n    data = label_df,\n    aes(x = long, y = lat, label = region),\n    size=3, \n    color = \"black\",\n    fill = \"white\",\n    fontface = \"bold\",\n    box.padding = 0.35, \n    point.padding = 0.25,\n    segment.color = \"black\",\n    segment.size = 1,\n    inherit.aes = FALSE,\n    force = 20,\n    min.segment.length = 0.1,\n    alpha = .7\n  )+\n  scale_fill_gradient(low = \"red\", high = \"green\",limits = c(3, 3.5)) +\n  theme_void() +\n  theme(panel.background = element_rect(fill = \"#cbe4ff\")) +\n  labs(\n    title = \"Where in the world the most popular chocolate bars come from\",\n    subtitle = \"Top 10 Countries by Review Ratings Labeled\",\n    fill = \"Average Rating\"\n  )\n```\n\n::: {.cell-output-display}\n![Where do the world's most popular cocoa beans come from?](index_files/figure-html/fig-jason-1.png){#fig-jason width=672}\n:::\n:::\n\n\n### Discussion\n\n(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.\n\nThe second plot does reveal a spatial clustering that we expected. The countries that produce cocoa beans exist in two man areas, Central/ South America and Southeast Asia. However, there is no specific area that stands out as the best for producing cocoa beans. There are 5 countries from each area that make up the top 10, and there are also come of the worst performing cocoa beans in these regions. It is likely that cocoa does require specific conditions for growth but seemingly as long those conditions are met the preferences for beans has more to do with specific processes within the countries then climate related.\n\n## Question 2: Title that relates to the question you're answering\n\n### Introduction\n\n(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.\n\nAs for our second question, we aim to investigate how the preferences of the chocolate bar reviewers have changed over time. We believe that this information will be useful for both the consumers and the producers: the consumers will be able to make informed decisions when purchasing chocolate and the producers can potentially use this information in modifying and improving their products competitively.\n\nTo explore the preferential change over time in chocolate bars, we will be using the variables that describe the year a chocolate bar review was written, the mapped continents in which the companies are located, and the ratings received in each review.\n\n### Approach\n\n(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g.boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.\n\n#### Plot 2.1\n\nTo create the first plot, we created line plots by year that show the relationship between the cocoa percentage of the chocolate bar and their ratings. In creating the variable with year information that will be used in faceting the plots, we grouped the year information provided in `review_date` into two year increments to create a new character variable (`year_even`) using the mutate function. We made this choice as 12 separate graphs (one for each year instead of for two years) would provide too much clutter, and it would be hard to visualize the trends across time. We also made a new variable, `avg_rating`, that stores the average rating for a cocoa percentage in a certain year by grouping the data by `year_even` and `cocoa_percentage`. For the plot, our x-axis variable is the cocoa percentage and the y-axis variable is the rating. The plot will be faceted into 6 time periods assigned within 2006 \\~ 2017. We created linear line graphs and scatterplots so we can see the overall trend of how ratings change as the cocoa percentage changes as well as some variation in the data, and we faceted by time periods how this relationship changed as time changed.\n\n#### Plot 2.2\n\nFor our second plot, we will be observing the relationship between the continent in which the company is located and their review ratings for each of the year groups created in Plot 1.1. We thought that it would be interesting to see which continental group of companies have become more popular or preferred over time and also use this information to understand how different continents have improved in their performance over the years.\n\nIn creating this plot, we plan to implement stacked bar plots representing the proportion of continents where companies are located for each respective faceted year using bar plot function from ggplot2 with `position = 'fill'` option to create a stacked bar graph with percentage proportions shown instead of counts. Since we are focusing on the proportion, stacked bar graphs visually showing the percentage proportions and their side-by-side comparison along identical axis would be an effective way to interpret the changes in proportions over time. Then similar to creating the faceting year variable, we will create a new, factored variable `rating_bin` that groups the review ratings in 0.5 intervals (\"0.0 \\~ 0.5\", \"0.5 \\~ 1.0\") where the lower bound is exclusive with the exception of the first group. For our plot, we will count and accumulate the number of ratings for each continent where the companies are located in and finally represent the count of continents for each level of rating as percentage proportions using the stacked bar plots. The x-axis variable of the plot will be the percentage proportions of continents and the y-axis variable is the factored review rating levels. We will differentiate the continents by using individual colors for easier readability. In doing this, we implemented a scale function from viridis package to map each continent to different colors in the mapping we specified (option H). Lastly, we will facet the plot into the 6 time periods used in Plot 1.1 to observe how the continental proportions have changed during the time frame.\n\n### Analysis\n\n(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate_merged1 <- chocolate_merged |>\n  mutate(\n    year_even = case_when(\n      review_date == 2006 | review_date == 2007 ~ \"2006-7\",\n      review_date == 2008 | review_date == 2009 ~ \"2008-9\",\n      review_date == 2010 | review_date == 2011 ~ \"2010-11\",\n      review_date == 2012 | review_date == 2013 ~ \"2012-13\",\n      review_date == 2014 | review_date == 2015 ~ \"2014-15\",\n      review_date == 2016 | review_date == 2017 ~ \"2016-17\"\n    )\n  ) |>\n  group_by(year_even, cocoa_percent) |>\n  mutate(avg_rating = mean(rating),\n         cocoa_percent = as.numeric(sub(\"%\", \"\", cocoa_percent))) |>\n  mutate(cocoa_percent = cocoa_percent / 100)\n\nggplot(chocolate_merged1, mapping = aes(x = cocoa_percent, y = avg_rating)) +\n  geom_point() +\n  geom_smooth(\n    aes(color = year_even),\n    method  = \"lm\",\n    se = FALSE,\n    show.legend = FALSE\n  ) +\n  facet_grid(year_even ~ ., scales = \"free_x\") +\n  theme_minimal() +\n  theme(aspect.ratio = 1 / 8) +\n  scale_y_continuous(breaks = c(1, 2, 3, 4, 5)) +\n  scale_x_continuous(breaks = c(.4, .5, .6, .7, .8, .9, 1),\n                     labels = scales::percent_format()) +\n  scale_color_viridis_d() +\n  labs(\n    x = \"Percentage of Cocoa in Chocolate\",\n    y = \"Average Rating\",\n    title = \"How well Cocoa Percentages are Rated\",\n    subtitle = \"By year, from 2006 to 2017\",\n    color = \"Year\"\n  )\n```\n\n::: {.cell-output-display}\n![Comparing the relationship between cocoa percentage and rating from 2006 to 2017](index_files/figure-html/fig-victoria-1.png){#fig-victoria width=672}\n:::\n:::\n\n\n#### Plot 2.2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchocolate_merged1 <- chocolate_merged1 |>\n  mutate(\n    rating_bin = case_when(\n      rating >= 0.00 & rating <= 0.50 ~ \"0.00 ~ 0.50\",\n      rating > 0.50 & rating <= 1.00 ~ \"0.50 ~ 1.00\",\n      rating > 1.00 & rating <= 1.50 ~ \"1.00 ~ 1.50\",\n      rating > 1.50 & rating <= 2.00 ~ \"1.50 ~ 2.00\",\n      rating > 2.00 & rating <= 2.50 ~ \"2.00 ~ 2.50\",\n      rating > 2.50 & rating <= 3.00 ~ \"2.50 ~ 3.00\",\n      rating > 3.00 & rating <= 3.50 ~ \"3.00 ~ 3.50\",\n      rating > 3.50 & rating <= 4.00 ~ \"3.50 ~ 4.00\",\n      rating > 4.00 & rating <= 4.50 ~ \"4.00 ~ 4.50\",\n      rating > 4.50 & rating <= 5.00 ~ \"4.50 ~ 5.00\"\n    )\n  )\n\nlibrary(viridis)\n\nggplot(chocolate_merged1, aes(x = factor(rating_bin), fill = continent)) +\n  geom_bar(position=\"fill\", stat = \"count\") +\n  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +\n  scale_fill_viridis(option = \"H\", discrete = TRUE) +\n  coord_flip() +\n  facet_grid(. ~ year_even) +\n  theme_minimal() +\n  guides(fill = guide_legend(title = \"Continent\")) +\n  theme(panel.spacing = unit(1, \"lines\"), panel.border = element_rect(color = \"black\", fill = NA, size = 0.05)) +\n  labs(x = \"Rating\", y = \"Percentage\", title = \"Proportion of Continents For Each Rating Group\", subtitle = \"By year, from 2006 to 2017\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-minwoo-1.png){#fig-minwoo width=672}\n:::\n:::\n\n\n### Discussion\n\n(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.\n\n#### Plot 2.1\n\nBased on the first plot, it can be seen that in general, as the percentage of cocoa increases, the ratings tend to decrease, indicating that people tend to prefer chocolate with less cocoa in it. However, this trend has lessened as time has progressed. In 2016-2017, there is no clear preference for chocolate with higher or lower cocoa percentages, but in 2006-2007, the data clearly indicates a preference for chocolate with lower cocoa percentage. Additionally, the data does not seem to contain much chocolate with less than 50% cocoa, as these chocolates only have data in 2010 to 2013. This may be an indication that chocolate companies produced more low cocoa chocolate during those years, but it could just be a lack of observations in this data set.\n\n#### Plot 2.2\n\nWe can observe from the second plot that in 2006 and 2007, higher proportion of the reviewed chocolate has been produced by companies in Europe with European companies taking up almost 90% of chocolate rated in the range of 3.50 ~ 4.00. However, from 2008 onward, we see that in general a large proportion of the chocolates reviewed are now produced by American companies. European companies are still present at higher ratings, taking up approximately 50% of chocolates rated in the range of 3.50 ~ 4.00. Then as the years go by, their proportions begin to reduce. This gradual shift continues until the final time period, 2016 ~ 2017, and by this period most of the chocolates reviewed are produced by American companies along with them producing most of higher-rated chocolates. Therefore it is clear from the plot that the preference for the general continental group of companies have changed over time from European companies to American companies.\n\nIn addition, this tells us that most of the earlier data points of our data set are mainly represented by European companies while those in the later time period are represented by American companies. This may further confirm that European companies have initially been dominant in their popularity as well as number of chocolates produced but American companies began outperforming them starting from 2008. We also see that in the later time periods, there are no chocolates reviewed above 4.5 or below 1.5. General rating range internet users may have become narrower in the recent years, with people giving increasingly specific ratings and having more similar palettes and experiences consuming chocolate.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}