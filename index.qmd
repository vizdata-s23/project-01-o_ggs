---
title: "Project title"
subtitle: "STA/ISS 313 - Project 1"
author: "Team Name"
format: html
editor: visual
---

```{r}
#| label: load-pkgs-data
#| warning: false
#| message: false


library(tidyverse)
library(janitor)
library(maps)

chocolate <- read_csv("data/flavors_of_cacao[1].csv")

chocolate <- chocolate |>
  clean_names()

con2cont <- read_csv("data/countryContinent.csv")


world <- map_data("world")

chocolate <- chocolate |>
  mutate(
    company_location_country = case_when(
      company_location == "U.S.A." ~ "United States of America",
      company_location == "U.K." ~ "United Kingdom of Great Britain and Northern Ireland",
      company_location == "Wales" ~ "United Kingdom of Great Britain and Northern Ireland",
      company_location == "Scotland" ~ "United Kingdom of Great Britain and Northern Ireland",
      company_location == "Russia" ~ "Russian Federation",
      company_location == "South Korea" ~ "Korea (Republic of)",
      company_location == "Amsterdam" ~ "Netherlands",
      company_location == "Sao Tome" ~ "Sao Tome and Principe",
      company_location == "Bolivia" ~ "Bolivia (Plurinational State of)",
      company_location == "Venezuela" ~ "Venezuela (Bolivarian Republic of)",
      company_location == "St. Lucia" ~ "Saint Lucia",
      company_location == "Vietnam" ~ "Viet Nam",
      company_location == "Domincan Republic" ~ "Dominican Republic",
      company_location == "Niacragua" ~ "Nicaragua",
      company_location == "Eucador" ~ "Ecuador",
      TRUE ~ company_location
    )
  )

con2cont <- con2cont |>
  select(country, continent)

con2cont <- con2cont |>
  rename(company_location_country = country)

chocolate_merged <- chocolate |>
  left_join(con2cont,
            multiple = "all")
```

## Abstract

(1 paragraph): Project abstract.

------------------------------------------------------------------------

## Introduction

(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.

## Question 1: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r}
#| warning: false
#| message: false

chocolate_merged1 <- chocolate_merged |>
  mutate(
    year_even = case_when(
      review_date == 2006 | review_date == 2007 ~ "2006-7",
      review_date == 2008 | review_date == 2009 ~ "2008-9",
      review_date == 2010 | review_date == 2011 ~ "2010-11",
      review_date == 2012 | review_date == 2013 ~ "2012-13",
      review_date == 2014 | review_date == 2015 ~ "2014-15",
      review_date == 2016 | review_date == 2017 ~ "2016-17"
    )
  ) |>
  group_by(year_even, cocoa_percent) |>
  mutate(avg_rating = mean(rating),
         cocoa_percent = as.numeric(sub("%", "", cocoa_percent))) 

ggplot(chocolate_merged1, mapping = aes(x = cocoa_percent, y = avg_rating)) +
  geom_line() +
  geom_smooth(aes(color = year_even), se = FALSE, show.legend = FALSE) +
  facet_grid(year_even ~., scales = "free_x") + 
  theme_minimal() + 
  theme(aspect.ratio = 1/8) +
  scale_y_continuous(breaks = c(1,2,3,4,5)) +
  labs(x = "Percentage of Cocoa in Chocolate", 
       y = "Average Rating", title = "How well Cocoa Percentages are Rated", 
       subtitle = "By year, from 2006 to 2017", color = "Year")

```

Q2 - Plot 2 (Minwoo)

```{r}
chocolate_merged1 <- chocolate_merged1 |>
  mutate(
    rating_bin = case_when(
      rating >= 0.00 & rating <= 0.50 ~ "0.00 ~ 0.50",
      rating > 0.50 & rating <= 1.00 ~ "0.50 ~ 1.00",
      rating > 1.00 & rating <= 1.50 ~ "1.00 ~ 1.50",
      rating > 1.50 & rating <= 2.00 ~ "1.50 ~ 2.00",
      rating > 2.00 & rating <= 2.50 ~ "2.00 ~ 2.50",
      rating > 2.50 & rating <= 3.00 ~ "2.50 ~ 3.00",
      rating > 3.00 & rating <= 3.50 ~ "3.00 ~ 3.50",
      rating > 3.50 & rating <= 4.00 ~ "3.50 ~ 4.00",
      rating > 4.00 & rating <= 4.50 ~ "4.00 ~ 4.50",
      rating > 4.50 & rating <= 5.00 ~ "4.50 ~ 5.00"
    )
  )

ggplot(chocolate_merged1, aes(x = factor(rating_bin), fill = continent)) +
  geom_bar(position="fill", stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  coord_flip() +
  facet_grid(. ~ year_even) +
  theme_minimal() +
  scale_fill_viridis_d() +
  guides(fill = guide_legend(title = "Continent")) +
  theme(panel.spacing = unit(1, "lines"), panel.border = element_rect(color = "black", fill = NA, size = 0.05)) +
  labs(x = "Rating", y = "Percentage", title = "Proportion of Continents For Each Rating Group", subtitle = "By year, from 2006 to 2017")
```

```{r}
chocolate_merged1 <- chocolate_merged1 |>
  mutate(
    rating_bin = case_when(
      rating >= 0.00 & rating <= 0.50 ~ "0.00 ~ 0.50",
      rating > 0.50 & rating <= 1.00 ~ "0.50 ~ 1.00",
      rating > 1.00 & rating <= 1.50 ~ "1.00 ~ 1.50",
      rating > 1.50 & rating <= 2.00 ~ "1.50 ~ 2.00",
      rating > 2.00 & rating <= 2.50 ~ "2.00 ~ 2.50",
      rating > 2.50 & rating <= 3.00 ~ "2.50 ~ 3.00",
      rating > 3.00 & rating <= 3.50 ~ "3.00 ~ 3.50",
      rating > 3.50 & rating <= 4.00 ~ "3.50 ~ 4.00",
      rating > 4.00 & rating <= 4.50 ~ "4.00 ~ 4.50",
      rating > 4.50 & rating <= 5.00 ~ "4.50 ~ 5.00"
    )
  )

ggplot(chocolate_merged1, aes(x = factor(rating_bin), fill = continent)) +
  geom_bar(position="fill", stat = "count") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  facet_grid(year_even ~ .) +
  theme_minimal() +
  scale_fill_viridis_d() +
  guides(fill = guide_legend(title = "Continent")) +
  theme(panel.spacing = unit(1, "lines"), panel.border = element_rect(color = "black", fill = NA, size = 0.05)) +
  labs(x = "Rating", y = "Percentage", title = "Proportion of Continents For Each Rating Group", subtitle = "By year, from 2006 to 2017")
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

## Question 2: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.
